#!/bin/bash
set -eu

# The "special var".
DEFAULT_MATRIXOS_DEV_DIR=/matrixos
MATRIXOS_DEV_DIR=${MATRIXOS_DEV_DIR:-"${DEFAULT_MATRIXOS_DEV_DIR}"}
# Directory used for file locks, to synchronize operations of various kind.
MATRIXOS_LOCKS_DIR="${MATRIXOS_LOCKS_DIR:-"${MATRIXOS_DEV_DIR}/locks"}"
# Directory used for various log files that can be generated by seeders, releasers, imagers.
MATRIXOS_LOGS_DIR="${MATRIXOS_LOGS_DIR:-"${MATRIXOS_DEV_DIR}/logs"}"
# Directory containing all the generated artifacts
MATRIXOS_OUT_DIR="${MATRIXOS_OUT_DIR:-${MATRIXOS_DEV_DIR}/out}"
# Name of the os.
MATRIXOS_OSNAME="${MATRIXOS_OSNAME:-matrixos}"
MATRIXOS_FANCY_OSNAME="${MATRIXOS_FANCY_OSNAME:-matrixOS}"
MATRIXOS_ARCH="${MATRIXOS_ARCH:-amd64}"

# matrixOS Git repos URLs and paths.
MATRIXOS_OVERLAY_GIT_REPO=${MATRIXOS_OVERLAY_GIT_REPO:-"https://github.com/lxnay/${MATRIXOS_OSNAME}-overlay.git"}
MATRIXOS_PRIVATE_EXAMPLE_GIT_REPO=${MATRIXOS_PRIVATE_EXAMPLE_GIT_REPO:-"https://github.com/lxnay/${MATRIXOS_OSNAME}-private-example.git"}

MATRIXOS_GIT_REPO=${MATRIXOS_GIT_REPO:-"https://github.com/lxnay/${MATRIXOS_OSNAME}.git"}
MATRIXOS_PRIVATE_GIT_REPO_PATH="${MATRIXOS_PRIVATE_GIT_REPO_PATH:-/etc/${MATRIXOS_OSNAME}-private}"
MATRIXOS_DEFAULT_USERNAME="${MATRIXOS_DEFAULT_USERNAME:-matrix}"

# OSTree releasing and pulling.
MATRIXOS_OSTREE_DIR="${MATRIXOS_OSTREE_DIR:-${MATRIXOS_DEV_DIR}/ostree}"
MATRIXOS_OSTREE_REPO_DIR="${MATRIXOS_OSTREE_DIR}/repo"
MATRIXOS_OSTREE_REMOTE="${MATRIXOS_OSTREE_REMOTE:-origin}"
MATRIXOS_OSTREE_REMOTE_URL="${MATRIXOS_OSTREE_REMOTE_URL:-"https://ostree.${MATRIXOS_OSNAME}.org"}"
MATRIXOS_OSTREE_KEEP_OBJECTS_YOUNGER_THAN="${MATRIXOS_OSTREE_KEEP_OBJECTS_YOUNGER_THAN:-2 months}"

## Seeders section
# Seeder base dir for generated artifacts.
MATRIXOS_SEEDER_OUT_DIR="${MATRIXOS_SEEDER_OUT_DIR:-${MATRIXOS_OUT_DIR}/seeder}"
MATRIXOS_SEEDER_DOWNLOADS_DIR="${MATRIXOS_SEEDER_OUT_DIR}/downloads"
MATRIXOS_SEEDER_DISTFILES_DIR="${MATRIXOS_SEEDER_OUT_DIR}/distfiles"
MATRIXOS_SEEDER_BINPKGS_DIR="${MATRIXOS_SEEDER_OUT_DIR}/binpkgs"
MATRIXOS_SEEDER_PORTAGE_REPOS_DIR="${MATRIXOS_SEEDER_OUT_DIR}/repos"
MATRIXOS_SEEDER_GPG_KEYS_DIR="${MATRIXOS_SEEDER_OUT_DIR}/gpg-keys"

# OSTree branches
# For committing and using the whole tree (including dev headers, etc.)
MATRIXOS_OSTREE_FULL_SUFFIX="full"

# OSTree GPG Support.
MATRIXOS_OSTREE_GPG_ENABLED="${MATRIXOS_OSTREE_GPG_ENABLED:-1}"
MATRIXOS_OSTREE_DEV_GPG_HOMEDIR="/var/tmp/ostree-gpg-private"
MATRIXOS_OSTREE_GPG_KEY_PATH="${MATRIXOS_OSTREE_GPG_KEY_PATH:-${MATRIXOS_PRIVATE_GIT_REPO_PATH}/ostree-gpg/keys/${MATRIXOS_OSNAME}-priv.bin.key}"
MATRIXOS_OSTREE_GPG_PUB_PATH="${MATRIXOS_OSTREE_GPG_PUB_PATH:-${MATRIXOS_PRIVATE_GIT_REPO_PATH}/ostree-gpg/keys/${MATRIXOS_OSNAME}-pub.bin.gpg}"
# Always import the in-git-repo pub key.
MATRIXOS_OSTREE_OFFICIAL_GPG_PUB_PATH="${MATRIXOS_OSTREE_OFFICIAL_GPG_PUB_PATH:-${MATRIXOS_DEV_DIR}/pubkeys/ostree-gpg/${MATRIXOS_OSNAME}-pub.bin.gpg}"
MATRIXOS_OSTREE_COLLECTION_ID="${MATRIXOS_OSTREE_COLLECTION_ID:-org.matrixos.Main}"

MATRIXOS_SECUREBOOT_KEY_PATH="${MATRIXOS_PRIVATE_GIT_REPO_PATH}/secureboot/keys/db/db.key"
MATRIXOS_SECUREBOOT_CERT_PATH="${MATRIXOS_PRIVATE_GIT_REPO_PATH}/secureboot/keys/db/db.pem"
MATRIXOS_JAILBROKEN_BOOT_LOADER_ENTRY="${MATRIXOS_OSNAME}-jailbroken.conf"

MATRIXOS_RO_VDB="/usr/var-db-pkg"
MATRIXOS_OSTREE_SYSROOT="/sysroot"
MATRIXOS_BOOT_ROOT="/boot"
MATRIXOS_EFI_ROOT="/efi"
MATRIXOS_RELATIVE_EFI_BOOT_PATH="efi/BOOT"
# /efi/efi/ROOT ... is WAI.
MATRIXOS_GRUB_CFG_EFI_PATH="${MATRIXOS_EFI_ROOT}/${MATRIXOS_RELATIVE_EFI_BOOT_PATH}/grub.cfg"
MATRIXOS_BOOT_EFI_EXECUTABLE="BOOTX64.EFI"

MATRIXOS_EFI_STANDARD_BOOT_PATH="\\EFI\\BOOT"
MATRIXOS_EFI_STANDARD_BOOT_EXECUTABLE_PATH="${MATRIXOS_EFI_STANDARD_BOOT_PATH}\\${MATRIXOS_BOOT_EFI_EXECUTABLE}"


