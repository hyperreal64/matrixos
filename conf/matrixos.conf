# matrixOS Configuration File
#
# This is the main configuration file for matrixOS.
#
# Configuration Loading:
# This file is loaded first. Then, any files ending in ".conf" located in
# the "matrixos.conf.d" directory (relative to this file) are loaded in
# alphabetical order.
#
# This allows for modular configuration and local overrides without modifying
# the main configuration file. For example, you can create a file named
# "conf/matrixos.conf.d/99-local.conf" to override specific settings.
#

[matrixOS]
# OsName is the default OS name (lowercase) for which we are building
# seeds, releases and images.
OsName=matrixos
# FancyOsName is the fancy version of OsName. Fancy is be defined as
# "a more marketing friendly name" for an OS which will not be used
# for technical purposes (e.g. as part of path names).
FancyOsName=matrixOS
# Identifies the CPU architecture (in the Gentoo Portage KEYWORDS sense).
Arch=amd64
# OverlayGitRepo is the URL for the matrixOS overlay git repository.
# It is listed here because it's not yet contained in the official
# Gentoo Portage repositories.xml file.
OverlayGitRepo=https://github.com/lxnay/matrixos-overlay.git
# GitRepo is the URL for the matrixOS git repository, where all this code
# and configs live.
GitRepo=https://github.com/lxnay/matrixos.git
# PrivateExampleGitRepo is the URL for the matrixOS private example git repository.
# See the PrivateGitRepoPath for more information.
PrivateExampleGitRepo=https://github.com/lxnay/matrixos-private-example.git
# PrivateGitRepoPath is the local (outside of chroots *and* inside of chroots)
# path where the (real) private Git repository containing private signing keys
# for OSTree, images and SecureBoot live. This is typically bind mount inside
# chroots by the seeding process and used for all signing operations. It contains
# both private keys (THAT YOU SHOULD NOT SHARE) and associated public keys.
# The path is relative to matrixOS.Root if the value is a relative path.
PrivateGitRepoPath=private/
# DefaultPrivateGitRepoPath is the default value for PrivateGitRepoPath that is
# going to be used inside chroots by seeder and Portage.
DefaultPrivateGitRepoPath=/etc/matrixos-private
# DefaultUsername is the username created by the build toolkit that acts as
# first and unique non-privileged user shipped by default with images.
DefaultUsername=matrix
# DefaultRoot is used for determining the matrixOS toolkit root
# inside chroots or during seeding processes.
DefaultRoot=/matrixos
# Root by default is `cwd` if unset, or relative to `cwd` if the path
# is relative, or absolute otherwise. It is the base path where all
# other paths are relative to, unless otherwise specified.
Root=./
# LogsDir is the path where logs produced by the toolkit should be
# stored. LogsDir is relative to matrixOS.Root, if the value is a relative path.
LogsDir=logs
# LocksDir is the path where file locks are stored. LocksDir is
# relative to matrixOS.Root, if the value is a relative path.
LocksDir=locks

#
# Seeder configuration.
# Seeder is the toolkit component that builds the system (chroot) off
# an initial seeding tarball (by default, a Gentoo stage3 tarball).
#
# Note: "prepper" is the term used to refer to the scripts that are preparing
# new chroots during the seeding process, before Seeder operates inside them.
# They can be used to clone seeds as a base to the seed being worked on.
# For example: 10-server uses the completed seed from 00-bedrock.
[Seeder]
# LocksDir is the path where file locks are stored during the seeding process.
# This is used by preppers to coordinate the seeding process across multiple
# chroots.
LocksDir=locks/seeder
# LockWaitSeconds is the number of seconds to wait before giving up on waiting
# for a seeder lock file to be acquired.
LockWaitSeconds=86400
# DownloadsDir is the path where seeder downloads are stored. (e.g. Gentoo
# stage3 tarballs) It is relative to matrixOS.Root, if the value is a relative
# path.
DownloadsDir=out/seeder/downloads
# DistfilesDir is the path where distfiles are stored. It is relative to
# matrixOS.Root, if the value is a relative path.
DistfilesDir=out/seeder/distfiles
# BinpkgsDir is the path where Portage binpkgs directories are stored. It is
# relative to matrixOS.Root, if the value is a relative path.
BinpkgsDir=out/seeder/binpkgs
# PortageReposDir is the path where the Portage repositories are stored and
# shared across all seeds. It is relative to matrixOS.Root, if the path is
# relative.
PortageReposDir=out/seeder/repos
# GpgKeysDir is the path where **Gentoo** releng GPG keys are stored. These
# keys are used for verifying Gentoo stage3 tarballs **only**. It is relative
# to matrixOS.Root, if the value is a relative path.
GpgKeysDir=out/seeder/gpg-keys
# SecureBootPrivateKey is the path to the private key used to sign boot binaries
# for SecureBoot enabled booting. It is relative to matrixOS.DefaultPrivateGitRepoPath,
# if the value is a relative path.
SecureBootPrivateKey=secureboot/keys/db/db.key
# SecureBootPublicKey is the path to the public cert, related to SecureBootPrivateKey
# used to sign boot binaries for SecureBoot enabled booting. It is relative to
# matrixOS.DefaultPrivateGitRepoPath, if the value is a relative path.
SecureBootPublicKey=secureboot/keys/db/db.pem
# SeederDisabledFileName is the name of the file that can be placed inside a seeder
# directory (e.g. 10-server) to disable the seeder. This is useful for quickly disabling
# seeders without having to change the seeder script or the seeder directory name.
SeederDisabledFileName=__disabled__
# PrepperExecutableName is the name of the executable script used as prepper during the
# seeding process. This is the script that is executed before entering chroots to
# prepare them for the seeding process. It is typically used to clone parent chroots as
# a base for the seed being worked on.
PrepperExecutableName=prepper.sh
# ChrootExecutableName is the name of the executable script used as chroot during the
# seeding process.
ChrootExecutableName=chroot.sh
# ParamsExecutableName is the name of the executable script used to set env vars inside
# chroots during the seeding process.
ParamsExecutableName=params.sh
# UseCpReflinkModeInsteadOfRsync controls whether preppers should clone parent chroots using
# cp --reflink=auto instead of using rsync. This can speed up copying operations significantly
# if the underlying filesystem supports it, but it can cause issues on filesystems that do not
# support it. Valid values are "true" or "false" only. The default value is "false" if unset.
UseCpReflinkModeInsteadOfRsync=true
# UseLocalGitRepoInsideChroot determines if the matrixOS.Root, if used in Git repo format
# should be cloned inside the chroot during the initial seed bootstrapping process, instead
# of executing a fresh `git clone` of matrixOS.GitRepo. This has the advantage of ensuring
# that external build tools and their APIs match what's being run from within the chroot.
UseLocalGitRepoInsideChroot=false
# DeleteDotGitFromGitRepo determines if the .git directory of the cloned matrixOS.GitRepo
# should be deleted after cloning.
DeleteDotGitFromGitRepo=false
# ChrootMetadataDir is the path inside chroots where some metadata about the seeding
# process is stored. This metadata is useful for debugging and release versioning
# information generation. It is purposely placed in /usr to keep it read-only.
# This must be an absolute path.
ChrootMetadataDir=/usr/share/matrixos/seeder/metadata
# ChrootMetadataDirBuildFileName is the file name of the text file placed inside
# ChrootMetadataDir that contains machine readable (env vars style) build information.
ChrootMetadataDirBuildFileName=build
# ChrootBuildArtifactsDir is the path inside chroots where preppers are allowed to store
# their own artifacts. It is typically used for storing temporary build artifacts that are
# needed across different preppers during the seeding process. This must be an absolute path.
ChrootBuildArtifactsDir=/build
# ChrootPreppersPhasesDir is the path inside chroots where preppers store their checkpoints
# (or phases state) during the seeding process. This is useful for allowing checkpointed resume
# of execution. This must be an absolute path.
ChrootPreppersPhasesStateDir=/build/preppers/.preppers_phases
# ChrootSeedersPhasesStateDir is the path inside chroots where seeders store their checkpoints
# (or phases state) during the seeding process. This is useful for allowing checkpointed resume
# of execution. This must be an absolute path.
# TODO: move this to /build/seeders/.seeders_phases.
ChrootSeedersPhasesStateDir=/build/.seeders_phases
# ChrootSeederDoneFlagFileNamePrefix is the file name prefix for the flag files placed inside
# ChrootSeedersPhasesStateDir by seeders when they complete their execution. This is useful for
# allowing checkpointed resume of execution and for letting Seeder/Releaser know which seeders have
# completed. The file is atomically created, once created, it should never be removed until
# the chroot gets deleted. To the prefix, Seeder adds the name of the seeder that completed.
ChrootSeederDoneFlagFileNamePrefix=seeder.complete

#
# Releaser configuration.
# Releaser is the toolkit component that turns completely built seeds into a
# matrixOS OSTree release commit.
[Releaser]
# LocksDir is the path where file locks are stored during the release process and used for
# coordinating release chroots management.
LocksDir=locks/releaser
# LockWaitSeconds is the number of seconds to wait before giving up on waiting
# for a Releaser lock.
LockWaitSeconds=86400
# UseCpReflinkModeInsteadOfRsync controls whether Releaser should use cp --reflink=auto instead
# of using rsync. This can speed up copying operations significantly if the underlying filesystem
# supports it, but it can cause issues on filesystems that do not support it. Valid values are
# "true" or "false" only. The default value is "false" if unset.
UseCpReflinkModeInsteadOfRsync=true
# ReadOnlyVdb is the path used to store a read-only Gentoo Portage vardb path
# after the OSTree FHS conversion process so that it can be distributed to
# clients (/var is not preserved).
ReadOnlyVdb=/usr/var-db-pkg
# Hostname is the default hostname of the released ostree repo.
Hostname=matrixos
# HooksDir is the path where release hooks are placed.
# Release hooks are used by the releaser to allow for branch specific
# release customizations. For example, if you are building a GNOME image
# you may want to prep the desktop for a gnomic experience!
# The directory acts as a base path for finding the hook script, which
# is then composed together with the ostree branch name (without -full suffix).
# The path is relative to matrixOS.Root, if the value is a relative path.
HooksDir=release/hooks
# GenerateStaticDeltas controls whether OSTree static deltas should be generated or not.
# Valid values can be "true" or "false" only. The default value is "false" if unset.
GenerateStaticDeltas=false

#
# Imager configuration.
# Imager is the toolkit component that builds bootable image files off
# Releaser generated releases.
[Imager]
# LocksDir is the path where file locks are stored during the imaging process.
LocksDir=locks/imager
# LockWaitSeconds is the number of seconds to wait before giving up on waiting
# for a imager lock file to be acquired.
LockWaitSeconds=86400
# ImagesDir is the path where generated images are stored. It is relative
# to matrixOS.Root, if the value is a relative path.
ImagesDir=out/images
# MountDir is the directory where image partitions are mounted during the image
# generation process. It is relative to matrixOS.Root, if the value is a relative path.
MountDir=out/mounts
# BootRoot is the boot filesystem mount point.
BootRoot=/boot
# EfiRoot is the EPS filesystem mount point.
EfiRoot=/efi
# RelativeEfiBootPath is the path, relative to EfiRoot, where the standard ESP
# boot directory is expected to be found.
RelativeEfiBootPath=efi/BOOT
# EfiExecutable is the name of the executable to place within the EFI boot path.
EfiExecutable=BOOTX64.EFI
# EfiStandardBootExecutablePath is the Windows-style path where the EFI executable
# should be placed. The file name MUST be the same as the value of EfiExecutable.
EfiStandardBootExecutablePath=\EFI\BOOT\BOOTX64.EFI
# ImageSize is the size of the generated image file. It should be big enough to
# contain the root filesystem and the boot and EFI partitions with some extra space
# for updates. Note that the image file is sparse, so the actual disk space used by
# the image file will be smaller than this value if the root filesystem is smaller.
# Also, once flashed to disk, the root partition inside the image will be resized to
# fill all the available space.
ImageSize=32G
# EfiPartitionSize is the size of the EFI partition to create inside the generated image.
EfiPartitionSize=200M
# BootPartitionSize is the size of the boot partition to create inside the generated image.
BootPartitionSize=1G
# Compressor is the command used to compress the generated .img files.
Compressor=xz -f -0 -T0
# Encryption controls whether the generated image should have an encrypted root filesystem or not.
# Valid values are "true" or "false" only. The default value is "false" if unset.
Encryption=false
# EncryptionKey is the key used for encrypting the root filesystem of the generated image if
# Encryption is set to "true". It is recommended to set this to a strong and unique value
# if encryption is enabled. Please note that this can be both the encryption password itself
# or (BETTER!) a path to a file containing the encryption password.
EncryptionKey=MatrixOS2026Enc
# EncryptedRootFsName is the name of the encrypted root filesystem to create inside the generated
# image if Encryption is set to "true". This is the name of the LUKS container and it is used as 
# part of the root partition setup during the image generation process.
EncryptedRootFsName=matrixosroot
# EspPartitionType is the partition type GUID to use for the EFI System Partition (ESP) when creating
# the partition table for the generated image. The default value is the standard ESP partition type GUID.
EspPartitionType=C12A7328-F81F-11D2-BA4B-00A0C93EC93B
# BootPartitionType is the partition type GUID to use for the Boot Partition when creating the partition
# table for the generated image. The default value is the standard Boot partition type GUID.
BootPartitionType=BC13C2FF-59E6-4262-A352-B275FD6F7172
# RootPartitionType is the partition type GUID to use for the Root Partition when creating the partition
# table for the generated image. The default value is the standard Root partition type GUID.
RootPartitionType=4F68BCE3-E8CD-4DB1-96E7-FBCAF984B709

#
# Jailbreaking configuration parameters.
# Jailbreaking is the tooling used to turn a matrixOS immutable filesystem back
# into a fully functional, mutable and no-longer atomic Gentoo-based distribution.
[Jailbreak]
# Name of the BLS file placed after the jailbreaking process.
BootLoaderEntry=matrixos-jailbroken.conf

# Ostree specific configuration parameters.
[Ostree]
# Sysroot is the canonical path to the ostree sysroot.
Sysroot=/sysroot
# Root is the path used as root for ostree operations (i.e. used as --sysroot=).
Root=/
# RepoDir is the directory where ostree repository data is stored, relative to
# matrixOS.Root if the value is a relative path.
RepoDir=ostree/repo
# Remote is the name of the default matrixOS ostree remote.
Remote=origin
# RemoteUrl is the URL of the default matrixOS ostree URL where ostree data is
# served from.
RemoteUrl=https://ostree.matrixos.org
# CollectionId is the OSTreee Collection ID associated to the defined OSTree
# repository.
CollectionId=org.matrixos.Main
# KeepObjectsYoungerThan is the mnemonically defined threshold after which data
# in the ostree repository is garbage collected. Keep this high enough so that
# people can roll back to arbitrarily large points in times as needed. It also
# defines the maximum rollback window.
KeepObjectsYoungerThan=2 months
# FullBranchSuffix is OSTree branch (or ref) suffix where the entire filesystem
# is stored. With entire filesystem, it is meant the root filesystem with all
# the compiler headers, static libraries and compiler itself. This can be used
# to temporarily or permanently turn matrixOS into a devel environment or back
# to a Gentoo environment.
FullBranchSuffix=full
# Gpg determines if GPG signing and validating support is enabled for the OSTree
# repository or not. Valid values can be "true" or "false" only.
Gpg=true
# DevGpgHomeDir is the gpg --homedir for the OSTree releaser and imager operations.
# Is is kept outside of chroots and root filesystems generated by the toolkit.
# The path is relative to matrixOS.Root if the value is a relative path.
DevGpgHomeDir=out/ostree-gpg-private
# GpgPrivateKey is the path to the private GPG key used by OSTree and Images to
# sign commits and data. It is relative to matrixOS.PrivateGitRepoPath if the
# path is relative.
GpgPrivateKey=ostree-gpg/keys/matrixos-priv.bin.key
# GpgPublicKey is the path to the public GPG key used by OSTree and Images to
# sign commits and data. It is relative to matrixOS.PrivateGitRepoPath if the
# path is relative.
GpgPublicKey=ostree-gpg/keys/matrixos-pub.bin.gpg
# GpgOfficialPublicKey is the path to the public GPG key used by OSTreee and Images to
# sign commits and data. This Key is usually shipped with this Git repository
# and its path is relative to matrixOS.Root if the value is a relative path.
GpgOfficialPublicKey=pubkeys/ostree-gpg/matrixos-pub.bin.gpg

#
# Cleaners configuration.
# Cleaners are the jobs ran by the Janitor binary to keep the matrixOS
# generated artifacts clean and tidy.

[DownloadsCleaner]
# DryRun controls whether the janitor cleaner for Seeder.DownloadsDir downloads
# should be executed or not. Valid values are "true" or "false" only. The default
# value is "false" if unset. Invalid values cause log warnings and are forcing the
# safe default (false).
DryRun=false

[LogsCleaner]
# DryRun controls whether the janitor cleaner for the matrixOS.LogsDir directory
# should be executed or not. Valid values are "true" or "false" only. The default
# value is "false" if unset. Invalid values cause log warnings and are forcing the
# safe default (false).
DryRun=false

[ImagesCleaner]
# DryRun controls whether the janitor cleaner for the Imager.OutDir directory should
# be executed or not. Valid values are "true" or "false" only. The default value
# is "false" if unset. Invalid values cause log warnings and are forcing the
# safe default (false).
DryRun=false
# MinAmountOfImages controls the minimum amount of (all) images to keep around in reverse
# chronological order. The images are the ones stored by Imager in Imager.OutDir.
MinAmountOfImages=3

